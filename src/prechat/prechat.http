### Pre-Chat Form API - Test Requests
### Use with REST Client extension in VS Code or import to Postman

@baseUrl = http://localhost:3000
@token = YOUR_JWT_TOKEN_HERE
@groupId = YOUR_GROUP_UUID_HERE

###############################################
# AGENT DASHBOARD ENDPOINTS (Protected)
###############################################

### 1. Create Pre-Chat Form
POST {{baseUrl}}/v1/prechat/admin/forms
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Customer Support Form",
  "description": "Please provide your details so we can assist you better",
  "isRequired": true,
  "isActive": true,
  "fields": [
    {
      "label": "Full Name",
      "type": "text",
      "isRequired": true,
      "placeholder": "Enter your full name",
      "order": 0
    },
    {
      "label": "Email Address",
      "type": "email",
      "isRequired": true,
      "placeholder": "your.email@example.com",
      "order": 1
    },
    {
      "label": "Phone Number",
      "type": "phone",
      "isRequired": false,
      "placeholder": "+1 (555) 123-4567",
      "order": 2
    },
    {
      "label": "Department",
      "type": "select",
      "isRequired": false,
      "options": ["Sales", "Technical Support", "Billing", "General Inquiry"],
      "order": 3
    },
    {
      "label": "How can we help you?",
      "type": "textarea",
      "isRequired": true,
      "placeholder": "Please describe your issue...",
      "order": 4
    },
    {
      "label": "Contact Method",
      "type": "radio",
      "isRequired": false,
      "options": ["Email", "Phone", "Chat"],
      "order": 5
    },
    {
      "label": "Newsletter Subscription",
      "type": "checkbox",
      "isRequired": false,
      "options": ["Yes, I want to receive updates"],
      "order": 6
    }
  ]
}

### 2. Get All Forms
GET {{baseUrl}}/v1/prechat/admin/forms
Authorization: Bearer {{token}}

### 3. Get Form by ID
@formId = FORM_UUID_HERE
GET {{baseUrl}}/v1/prechat/admin/forms/{{formId}}
Authorization: Bearer {{token}}

### 4. Update Form
PATCH {{baseUrl}}/v1/prechat/admin/forms/{{formId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Updated Support Form",
  "description": "Updated description",
  "isActive": true,
  "fields": [
    {
      "label": "Name",
      "type": "text",
      "isRequired": true,
      "order": 0
    },
    {
      "label": "Email",
      "type": "email",
      "isRequired": true,
      "order": 1
    }
  ]
}

### 5. Delete Form (Soft Delete)
DELETE {{baseUrl}}/v1/prechat/admin/forms/{{formId}}
Authorization: Bearer {{token}}

### 6. Get Conversation Pre-Chat Data (Agent View)
@conversationId = CONVERSATION_UUID_HERE
GET {{baseUrl}}/v1/prechat/admin/conversations/{{conversationId}}/prechat
Authorization: Bearer {{token}}

###############################################
# WIDGET ENDPOINTS (Public - No Auth)
###############################################

### 7. Get Active Form for Group
GET {{baseUrl}}/v1/prechat/widget/groups/{{groupId}}/form

### 8. Submit Pre-Chat Form
POST {{baseUrl}}/v1/prechat/widget/submit
Content-Type: application/json

{
  "formId": "{{formId}}",
  "visitorId": "visitor-uuid-12345",
  "answers": [
    {
      "fieldId": "field-uuid-1",
      "value": "John Doe"
    },
    {
      "fieldId": "field-uuid-2",
      "value": "john.doe@example.com"
    },
    {
      "fieldId": "field-uuid-3",
      "value": "+1 555 123 4567"
    },
    {
      "fieldId": "field-uuid-4",
      "value": "Technical Support"
    },
    {
      "fieldId": "field-uuid-5",
      "value": "I need help setting up my account and configuring the settings."
    },
    {
      "fieldId": "field-uuid-6",
      "value": "Email"
    },
    {
      "fieldId": "field-uuid-7",
      "value": "Yes, I want to receive updates"
    }
  ]
}

### 9. Get Conversation Pre-Chat (Visitor View)
GET {{baseUrl}}/v1/prechat/widget/conversations/{{conversationId}}/prechat

### 10. Check if Conversation Has Pre-Chat
GET {{baseUrl}}/v1/prechat/widget/conversations/{{conversationId}}/has-prechat

###############################################
# EXAMPLE: Complete Flow
###############################################

### STEP 1: Agent creates form
# POST /v1/prechat/admin/forms
# (Copy formId from response)

### STEP 2: Widget retrieves form
# GET /v1/prechat/widget/groups/{groupId}/form
# (Display form to visitor)

### STEP 3: Visitor submits form
# POST /v1/prechat/widget/submit
# (Creates conversation + snapshot + answers)
# (Copy conversationId from response)

### STEP 4: Agent views submission
# GET /v1/prechat/admin/conversations/{conversationId}/prechat
# (Agent sees visitor's responses)

###############################################
# TEST SCENARIOS
###############################################

### Scenario: Missing Required Field (Should Return 400)
POST {{baseUrl}}/v1/prechat/widget/submit
Content-Type: application/json

{
  "formId": "{{formId}}",
  "visitorId": "visitor-uuid",
  "answers": [
    {
      "fieldId": "field-uuid-1",
      "value": "John Doe"
    }
  ]
}

### Scenario: Invalid Form ID (Should Return 404)
POST {{baseUrl}}/v1/prechat/widget/submit
Content-Type: application/json

{
  "formId": "invalid-form-id",
  "visitorId": "visitor-uuid",
  "answers": []
}

### Scenario: Get Non-Existent Conversation (Should Return 404)
GET {{baseUrl}}/v1/prechat/widget/conversations/non-existent-id/prechat

###############################################
# VALIDATION TESTS
###############################################

### Test: Empty Form ID
POST {{baseUrl}}/v1/prechat/widget/submit
Content-Type: application/json

{
  "formId": "",
  "answers": []
}

### Test: Invalid Field Type in Create
POST {{baseUrl}}/v1/prechat/admin/forms
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Test Form",
  "fields": [
    {
      "label": "Test",
      "type": "invalid_type",
      "isRequired": true
    }
  ]
}

### Test: Missing Required DTO Fields
POST {{baseUrl}}/v1/prechat/admin/forms
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Test Form"
}

###############################################
# NOTES
###############################################

# 1. Replace {{token}} with actual JWT token from auth
# 2. Replace {{groupId}} with actual group UUID
# 3. Replace {{formId}} with form UUID after creation
# 4. Replace field UUIDs with actual field IDs
# 5. Use REST Client extension or Postman
# 6. Ensure server is running on http://localhost:3000
